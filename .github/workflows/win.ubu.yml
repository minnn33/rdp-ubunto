name: Windows-like Desktop (Cloudflare Tunnel)

on: [workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: ØªØ«Ø¨ÙŠØª Ø³Ø·Ø­ Ø§Ù„Ù…ÙƒØªØ¨ + Wine + VNC
        run: |
          sudo dpkg --add-architecture i386
          sudo apt update
          sudo apt install xfce4 xfce4-goodies tightvncserver wine64 wine32 wget unzip -y

          # Ø¥Ø¹Ø¯Ø§Ø¯ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± VNC
          mkdir -p ~/.vnc
          echo "${{ secrets.VNC_PASSWORD }}" | vncpasswd -f > ~/.vnc/passwd
          chmod 600 ~/.vnc/passwd

          # ØªØ´ØºÙŠÙ„ VNC Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©
          vncserver :1
          vncserver -kill :1

          # Ù…Ù„Ù Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ VNC Ø¨Ø¨ÙŠØ¦Ø© XFCE4
          echo "#!/bin/bash
          xrdb \$HOME/.Xresources
          startxfce4 &" > ~/.vnc/xstartup
          chmod +x ~/.vnc/xstartup

          # ØªØ´ØºÙŠÙ„ VNC Ù…Ø¹ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯
          vncserver :1 -geometry 1280x720 -depth 24

      - name: ØªØ«Ø¨ÙŠØª Cloudflared
        run: |
          wget -O cloudflared https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64
          chmod +x cloudflared
          sudo mv cloudflared /usr/local/bin/

      - name: ØªØ´ØºÙŠÙ„ Cloudflare Tunnel
        run: |
          echo "âœ… Ø¨Ø¯Ø¡ Cloudflare Tunnel Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ÙØ° 5901 ..."
          cloudflared tunnel --no-autoupdate run --token ${{ secrets.CLOUDFLARED_TOKEN }} > cf.log 2>&1 &
          sleep 15
          echo "ðŸ“¡ Ø³Ø¬Ù„ Cloudflare:"
          cat cf.log || true
